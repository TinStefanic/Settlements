@page "/"
@using Settlements.Client.DTOs
@using Settlements.Client.Services
@inject HostClient HostClient;

<PageTitle>Index</PageTitle>

<SettlementPaginatedTable Countries="@CountriesOrEmpty" PaginatedSettlements="@_paginatedSettlements"/>

<AddNewSettlementForm Countries="@CountriesOrEmpty" OnSuccessfullyAdded="RefreshPageAsync"/>

@code {
    private IEnumerable<CountryDTO>? _countries;
    private PaginatedSettlementsDTO? _paginatedSettlements;

    private IEnumerable<CountryDTO> CountriesOrEmpty => _countries ?? Enumerable.Empty<CountryDTO>();

    protected override async Task OnInitializedAsync()
    {
        _countries = await HostClient.GetCountryDTOsAsync();
        _paginatedSettlements = await HostClient.GetPaginatedSettlementsDTOAsync();
        StateHasChanged();
    }

    private async Task RefreshPageAsync() 
    {
        int? pageNumber = _paginatedSettlements?.PageNumber;
        int? pageSize = _paginatedSettlements?.PageSize;

        _paginatedSettlements = await HostClient.GetPaginatedSettlementsDTOAsync(pageNumber, pageSize);
        StateHasChanged();
    }
}
